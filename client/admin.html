<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة تحكم الإدارة</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #2c3e50; color: #ecf0f1; margin: 0; display: flex; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: #34495e; height: 100vh; padding: 20px; }
        .sidebar h2 { margin-bottom: 40px; color: #3498db; }
        .menu-item { padding: 15px; cursor: pointer; border-bottom: 1px solid #7f8c8d; transition: 0.3s; }
        .menu-item:hover { background: #2c3e50; padding-right: 25px; }

        /* Main Content */
        .content { flex: 1; padding: 40px; overflow-y: auto; height: 100vh; }
        
        .stat-card { background: #fff; color: #333; padding: 20px; border-radius: 8px; display: inline-block; width: 200px; margin-left: 20px; text-align: center; }
        .stat-num { font-size: 2rem; font-weight: bold; color: #e74c3c; }

        table { width: 100%; border-collapse: collapse; background: #ecf0f1; color: #333; margin-top: 20px; border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background: #bdc3c7; }
        
        .btn-approve { background: #27ae60; color: white; border: none; padding: 5px 15px; cursor: pointer; border-radius: 4px; }
        .section { display: none; }
        .section.active { display: block; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>لوحة الأدمن</h2>
        <div class="menu-item" onclick="showSection('dashboard')">الإحصائيات</div>
        <div class="menu-item" onclick="showSection('pending')">طلبات النشر</div>
        <div class="menu-item" onclick="showSection('otps')">رموز التحقق (OTP)</div>
    </div>

    <div class="content">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section active">
            <h1>نظرة عامة</h1>
            <div id="stats-container">
                <div class="stat-card">المستخدمين <div class="stat-num" id="s-users">-</div></div>
                <div class="stat-card">الحجوزات <div class="stat-num" id="s-bookings">-</div></div>
                <div class="stat-card">الأرباح <div class="stat-num" id="s-revenue">-</div></div>
            </div>
        </div>

        <!-- Pending Listings Section -->
        <div id="pending" class="section">
            <h1>طلبات بانتظار الموافقة</h1>
            <table>
                <thead>
                    <tr>
                        <th>النوع</th>
                        <th>العنوان</th>
                        <th>السعر</th>
                        <th>إجراء</th>
                    </tr>
                </thead>
                <tbody id="pending-table"></tbody>
            </table>
        </div>

        <!-- OTPs Section -->
        <div id="otps" class="section">
            <h1>مراقبة OTP (للتحقق)</h1>
            <table>
                <thead>
                    <tr>
                        <th>رقم الهاتف</th>
                        <th>الكود</th>
                        <th>الوقت</th>
                    </tr>
                </thead>
                <tbody id="otp-table"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API = 'http://localhost:3000/api';

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'dashboard') loadStats();
            if(id === 'pending') loadPending();
            if(id === 'otps') loadOtps();
        }

        async function loadStats() {
            const res = await fetch(`${API}/admin/stats`);
            const data = await res.json();
            document.getElementById('s-users').innerText = data.users;
            document.getElementById('s-bookings').innerText = data.bookings;
            document.getElementById('s-revenue').innerText = data.revenue + ' ريال';
        }

        async function loadPending() {
            const res = await fetch(`${API}/admin/listings/pending`);
            const data = await res.json();
            const html = data.map(item => `
                <tr>
                    <td>${item.type}</td>
                    <td>${item.title}</td>
                    <td>${item.price}</td>
                    <td><button class="btn-approve" onclick="approve(${item.id})">موافقة ونشر</button></td>
                </tr>
            `).join('');
            document.getElementById('pending-table').innerHTML = html || '<tr><td colspan="4" style="text-align:center">لا يوجد طلبات معلقة</td></tr>';
        }

        async function approve(id) {
            await fetch(`${API}/admin/approve/${id}`, { method: 'POST' });
            loadPending();
        }

        async function loadOtps() {
            const res = await fetch(`${API}/admin/otps`);
            const data = await res.json();
            const html = data.map(item => `
                <tr>
                    <td>${item.phone}</td>
                    <td style="color: #c0392b; font-weight: bold; letter-spacing: 2px;">${item.code}</td>
                    <td>${new Date(item.created_at).toLocaleTimeString()}</td>
                </tr>
            `).join('');
            document.getElementById('otp-table').innerHTML = html;
        }

        // Load dashboard on start
        loadStats();
    </script>
</body>
</html>
