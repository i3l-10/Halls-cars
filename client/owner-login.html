<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة الشركاء - الملاك</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #2c3e50; --accent: #e67e22; --bg: #ecf0f1; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); margin: 0; }
        
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; }
        
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%; }
        input, select, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; color: white; }
        .status-pending { background: #f39c12; }
        .status-active { background: #27ae60; }
    </style>
</head>
<body>

    <div class="header">
        <h2><i class="fas fa-briefcase"></i> بوابة الشركاء</h2>
    </div>

    <!-- Login -->
    <div id="login-screen" class="container">
        <div class="card">
            <h3>تسجيل دخول الشركاء</h3>
            <input type="text" id="phone" placeholder="رقم الجوال">
            <input type="password" id="pass" placeholder="كلمة المرور">
            <button class="btn" onclick="login()">دخول</button>
            <p style="text-align:center; margin-top:10px;"><small>للتسجيل الجديد، استخدم صفحة التطبيق واختر "مالك" (غير مفعل في هذا الديمو)</small></p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="container" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3>عقاراتي / سياراتي</h3>
            <button class="btn" style="width: auto;" onclick="document.getElementById('add-modal').style.display='block'">+ إضافة جديد</button>
        </div>

        <div id="my-listings"></div>
    </div>

    <!-- Add Modal -->
    <div id="add-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
        <div class="card" style="margin: 50px auto; max-width: 500px;">
            <h3>إضافة جديد</h3>
            <select id="l-type">
                <option value="hall">قاعة</option>
                <option value="chalet">شالية</option>
                <option value="car">سيارة</option>
            </select>
            <input type="text" id="l-title" placeholder="الاسم (مثال: شالية الروز)">
            <input type="number" id="l-price" placeholder="السعر اليومي">
            <input type="text" id="l-location" placeholder="الموقع">
            <input type="text" id="l-image" placeholder="رابط الصورة">
            <textarea id="l-desc" placeholder="الوصف..."></textarea>
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="addListing()">إرسال للمراجعة</button>
                <button class="btn" style="background: #7f8c8d;" onclick="document.getElementById('add-modal').style.display='none'">إلغاء</button>
            </div>
        </div>
    </div>

    <script>
        const API = 'http://localhost:3000/api';
        let owner = null;

        async function login() {
            const phone = document.getElementById('phone').value;
            const pass = document.getElementById('pass').value;
            // For demo purposes, assumes user exists. Real app checks role.
            const res = await fetch(`${API}/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ phone, password: pass })
            });
            const data = await res.json();
            if(res.ok) {
                owner = data.user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadListings();
            } else {
                alert(data.error);
            }
        }

        async function loadListings() {
            const res = await fetch(`${API}/listings/owner/${owner.id}`);
            const data = await res.json();
            document.getElementById('my-listings').innerHTML = data.map(item => `
                <div class="card">
                    <div style="display:flex; justify-content:space-between;">
                        <h4>${item.title} <small>(${item.type})</small></h4>
                        <span class="status-badge status-${item.status}">${item.status === 'active' ? 'نشط' : 'قيد المراجعة'}</span>
                    </div>
                    <p>السعر: ${item.price} | الموقع: ${item.location}</p>
                </div>
            `).join('');
        }

        async function addListing() {
            const body = {
                owner_id: owner.id,
                title: document.getElementById('l-title').value,
                type: document.getElementById('l-type').value,
                price: document.getElementById('l-price').value,
                location: document.getElementById('l-location').value,
                image_url: document.getElementById('l-image').value,
                description: document.getElementById('l-desc').value
            };

            const res = await fetch(`${API}/listings`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });
            if(res.ok) {
                alert('تم الإرسال بنجاح بانتظار موافقة الإدارة');
                document.getElementById('add-modal').style.display = 'none';
                loadListings();
            }
        }
    </script>
</body>
</html>
